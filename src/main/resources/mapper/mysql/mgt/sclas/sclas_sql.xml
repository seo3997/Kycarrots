<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mgt.sclas">


	<select id="selectListItem" parameterType="dataMap" resultType="dataMap">
	/* mgt.sclas.selectListItem */
		SELECT AA.*
		      ,(SELECT COUNT(SCLAS_CODE) 
		        FROM op_sclas_code
		        WHERE GROUP_ID = #{group_id}
		        AND  CODE=AA.CODE
		        AND   USE_YN	  ='Y'
		        ) AS SCLASCNT 
		FROM (
			SELECT 1 AS DISID
			      , A1.GROUP_ID
				  ,A1.CODE
				  ,'' AS SCLAS_CODE
				  ,A1.CODE_NM
				  ,'' AS SCLAS_NM
				  ,A1.SORT_ORDR
			FROM op_code A1
			WHERE A1.GROUP_ID =#{group_id}
		   UNION ALL
			SELECT 	2 AS DISID  
			        ,A1.GROUP_ID
					,A1.CODE
					,A1.SCLAS_CODE
					,'' AS CODE_NM
					,A1.SCLAS_NM
					,A2.SORT_ORDR
			FROM op_sclas_code A1 JOIN op_code A2  ON A1.GROUP_ID=A2.GROUP_ID AND A1.CODE=A2.CODE
			WHERE 	A1.GROUP_ID = #{group_id}
			AND     A1.USE_YN	  ='Y'
		) AA
		<if test="item_code != null and item_code != ''">
		WHERE AA.CODE=#{item_code}
		</if>
		ORDER BY  AA.GROUP_ID,AA.SORT_ORDR,AA.DISID,AA.SCLAS_CODE
	</select>


	
	<select id="selectOpCodeNm" parameterType="dataMap" resultType="dataMap">
	/* mgt.sclas.selectMenu */
	SELECT   A1.CODE
				, A1.CODE_NM
	FROM op_code A1
	WHERE A1.GROUP_ID 	=#{group_id}
		AND A1.CODE 			= #{op_code}
		AND A1.USE_YN 		= 'Y'
	ORDER BY A1.SORT_ORDR
	</select>
	
	<select id="selectListSclas" parameterType="dataMap" resultType="dataMap">
	/* mgt.sclas.selectListSclas */
	SELECT A1.GROUP_ID
		, A1.CODE
		, A1.SCLAS_CODE
		, A1.SCLAS_NM
		, A1.ATTRB_1
		, A1.ATTRB_2
		, A1.ATTRB_3
		, A1.SORT_ORDR
	FROM op_sclas_code A1
	WHERE 	A1.GROUP_ID 	= #{group_id}
	AND 		A1.CODE 	= #{op_code}
	AND 		A1.USE_YN	='Y'
	ORDER BY A1.SORT_ORDR
	</select>

	<select id="selectSclas" parameterType="dataMap" resultType="dataMap">
	/* mgt.sclas.selectSclas */
	SELECT A1.GROUP_ID
		, A1.CODE
		, A1.SCLAS_CODE
		, A1.SCLAS_NM
		, A1.ATTRB_1
		, A1.ATTRB_2
		, A1.ATTRB_3
		, A1.SORT_ORDR
		, A1.USE_YN
	FROM op_sclas_code A1
	WHERE 	A1.GROUP_ID 		= #{group_id}
	AND 		A1.CODE 				= #{op_code}
	AND 		A1.SCLAS_CODE 	= #{sclas_code}
	</select>
	
	<delete id="deleteSclas" parameterType="dataMap">
	/*  mgt.sclas.deleteSclas */
	DELETE FROM op_sclas_code
	WHERE 	GROUP_ID 		= #{group_id}
	AND     CODE 				= #{op_code}
	AND 		SCLAS_CODE 	= #{sclas_code}
	</delete>
	
	<insert id="insertSclas" parameterType="dataMap">
	/*  mgt.sclas.insertSclas */
	INSERT INTO op_sclas_code (
	    GROUP_ID
	    ,CODE
	    ,SCLAS_CODE
		, SCLAS_NM
		, ATTRB_1
		, ATTRB_2
		, ATTRB_3
		, SORT_ORDR
		, REGISTER_NO
		, REGIST_DT
		, UPDUSR_NO
		, UPDT_DT
	) VALUES (
		  #{group_id}
		 ,#{op_code}
		 ,#{sclas_code}
		, #{sclas_nm}
		, #{attrb_1}
		, #{attrb_2}
		, #{attrb_3}
		, #{sort_ordr}
		, #{ss_user_no}
		, CURRENT_TIMESTAMP
		, #{ss_user_no}
		, CURRENT_TIMESTAMP
	)
	</insert>
	
	<update id="updateSclas" parameterType="dataMap">
	/*  mgt.sclas.updateSclas */
	UPDATE op_sclas_code 
		SET 	 SCLAS_NM		=#{sclas_nm}
				, ATTRB_1			=#{attrb_1}
				, ATTRB_2			=#{attrb_2}
				, ATTRB_3			=#{attrb_3}
				, SORT_ORDR	=#{sort_ordr}
				, UPDUSR_NO	=#{ss_user_no}
				, UPDT_DT	 	=CURRENT_TIMESTAMP
	WHERE 	GROUP_ID		= #{group_id}
	AND     CODE 				= #{op_code}
	AND 		SCLAS_CODE	= #{sclas_code}
	</update>

	<update id="updateSclasUseYn" parameterType="dataMap">
	/*  mgt.sclas.updateSclas */
	UPDATE op_sclas_code 
		SET 	 USE_YN			='N'
				, UPDUSR_NO	=#{ss_user_no}
				, UPDT_DT	 	=CURRENT_TIMESTAMP
	WHERE 	GROUP_ID		= #{group_id}
	AND     CODE 				= #{op_code}
	AND 		SCLAS_CODE	= #{sclas_code}
	</update>

	
</mapper>